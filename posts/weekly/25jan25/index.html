<!DOCTYPE html><html lang="zh-cn" class="animation-prepared"> <head><title>周报 0x01: ボクの理想の Python</title><meta charset="utf-8"><link rel="canonical" href="https://blog.mslxl.com/posts/weekly/25jan25/"><meta name="description" content="My story of discovery"><meta name="robots" content="index, follow"><meta property="og:title" content="周报 0x01: ボクの理想の Python"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.mslxl.com/placeholder.png"><meta property="og:url" content="https://blog.mslxl.com"><link rel="icon" href="/favicon.jpg" type="image/jpg"><link rel="alternate" type="application/rss+xml" title="Integrate Life" href="https://blog.mslxl.com/atom.xml"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.6.1"><meta name="twitter:image:src" content="https://blog.mslxl.com/placeholder.png"><meta name="twitter:image:alt" content="My story of discovery"><meta name="twitter:creator" content="@mslxl_bak"><meta name="twitter:site" content="@mslxl_bak"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="周报 0x01: ボクの理想の Python"><meta name="twitter:description" content="My story of discovery"><link rel="stylesheet" href="/_astro/_page_.DKbO41Ir.css">
<style>.tk-meta-input{background-color:#fff}
p[data-astro-cid-gcn2mc3v]{font-size:.75rem;font-weight:700}html.animation-prepared .transition-swup-header[data-astro-cid-e5lvscu2],html.animation-prepared .transition-swup-footer[data-astro-cid-e5lvscu2]{animation:fade-in-down 1s linear 1}@media (min-width: 1024px){html.animation-prepared .transition-swup-header[data-astro-cid-e5lvscu2],html.animation-prepared .transition-swup-footer[data-astro-cid-e5lvscu2]{animation-name:fade-in-left}}html.animation-prepared .transition-swup-main[data-astro-cid-e5lvscu2]{animation:fade-in-down 1s linear 1}@keyframes fade-in-down{0%{transform:translateY(-1rem);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes fade-in-left{0%{opacity:0;transform:translate(1rem)}to{opacity:1;transform:translate(0)}}html.is-animating .transition-swup-main[data-astro-cid-e5lvscu2]{opacity:0;transform:translateY(-1rem)}html.is-leaving .transition-swup-main[data-astro-cid-e5lvscu2]{opacity:0;transform:translateY(1rem)}.transition-swup-main[data-astro-cid-e5lvscu2]{transition-duration:.5s;transition-timing-function:linear;transform:translateY(0);opacity:1}
.code-container{position:relative}.clipboard-copy{position:absolute;top:.5rem;right:.5rem;width:1.75rem;height:1.75rem;display:flex;justify-content:center;align-items:center;border-radius:.25rem}.clipboard-copy:hover{background-color:#30363d}
</style>
<link rel="stylesheet" href="/_astro/index.DuX3xYS3.css"><script type="module" src="/_astro/page.BTbYB4Kr.js"></script></head> <body>   <div class="h-100vh max-w-6xl min-w-390px mx-a grid-gap-x-28" p="7.5 lg:y-0 lg:x-20" lg="grid cols-[3fr_1fr] rows-[1fr_9rem]" data-astro-cid-e5lvscu2> <header class="transition-swup-header flex flex-col gap-2.5" m="7.5 lg:x-0 lg:t-20 lg:b-4" lg="row-1-2 col-2-3 justify-between items-start" data-astro-cid-e5lvscu2> <hgroup lg="write-vertical-right items-start b-l-2px b-l-primary-solid text-left" flex="~ col gap-2.5" class="cursor-pointer text-center duration-800 ease-in-out"> <a class="not-underline-hover duration-800 ease-in-out" lg:p="x-2.5 b-12 hover:t-3.75 hover:b-8.75" hover:lg=" bg-primary color-background" href="/"> <h3 class="text-5 font-extrabold font-header">Mslxl&#39;s Blog</h3> <h1 class="text-8 font-extrabold font-header">Integrate Life</h1> </a> </hgroup> <nav class="text-center font-bold" flex="~ col gap-4"> <ul lg="flex-col items-start text-4" class="text-3.5" flex="~ row gap-2 justify-center"> <li> <a class="" href="/"> 文章 </a> </li><li> <a class="" href="/archive"> 归档 </a> </li><li> <a class="" href="/categories"> 分类 </a> </li><li> <a class="" href="/tomodachi"> 友人 </a> </li><li> <a class="" href="/about"> 关于 </a> </li> </ul> <ul flex="~ row gap-1 justify-center"> <li> <a href="https://github.com/mslxl/" target="_blank" title="github" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-github w-6 h-6">github</span> </a> </li><li> <a href="/atom.xml" target="_blank" title="rss" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-rss w-6 h-6">rss</span> </a> </li><li> <a href="https://x.com/mslxl_bak/" target="_blank" title="twitter" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-twitter w-6 h-6">twitter</span> </a> </li><li> <a href="https://mastodon.social/@mslxl" target="_blank" title="mastodon" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-mastodon w-6 h-6">mastodon</span> </a> </li> </ul> </nav> </header> <main class="transition-swup-main link-fill overflow-y-scroll scrollbar-hide outline-none" lg="row-1-3 col-1-2 py-20 " data-astro-cid-e5lvscu2>   <article class="prose"> <header flex="~ col"> <h1 class="post-title"> <a class="not-prose" href="/posts/weekly/25jan25/">周报 0x01: ボクの理想の Python</a> </h1> <div class="text-3.5"> <span>发布于</span> <time>2025-01-25</time> <a href="/categories/Weekly">
# Weekly </a><a href="/categories/Python">
# Python </a><a href="/categories/Compiler">
# Compiler </a><a href="/categories/duolinguo">
# 多邻国 </a> </div> </header>  <p>为了记录我的精神状态，我决定从今天开始写周报了。虽然说是周报，但不一定每周都写，有可能数个月才写一次。</p>
<p>换句话说，等我精神不稳定的时候才会来写周报。</p>
<hr>
<h2 id="日语">日语</h2>
<p>再见了，多邻国。</p>
<p><img alt="Duolingo Strike" width="212" height="451" loading="lazy" decoding="async" src="/_astro/duolingo.CXQ6X_5U_XXn0H.webp" ></p>
<p>大概是3年前，我开始使用多邻国学习日语和世界语。后来渐渐的将世界语丢掉只学日语了，到现在世界语也只能算个 komencanto。
而日语却一直坚持了下来，到现在连续打卡已经有 627 天了。这1000余天我通过多邻国学到了什么？其实我觉得我什么也没有学到。
在老中的特色汉字 buff 下，我还勉强能看懂简单的句子，但却说不出、写不下简单的单词。在今天，我觉得是时候放下 Duolingo 转向其他正常的学习方式了。</p>
<p>多邻国有什么问题？首先它其中的题目有一些问题。比如在其中的听力中，有时会同时出现
「<span lang="jp">中村さん</span>」和 「<span lang="jp"> なかむらさん</span>」 两个选项，然而只有前者是被认为正确的。
再者，使用中文学习日语时不能完全对等的翻译。例如「<span lang="jp">この味噌汁は安いです</span>」的中文表达是 「这个味增汤很便宜」。
然而中文中的“很”并不表示程度，它只是一种语气词(?)。然而当你尝试翻译回去的时候，也许 「<span lang="jp">とても</span>」 就出现了，你就又错了一题。
同理，还有「はい，元気です」中文特色倒桩句「是，我好的很」。总之，在多邻国学习使用汉语学习其他语言可能并不是一个好选择。</p>
<p>此外，多邻国最大的问题就是——它不讲语法。所有的问题到要用户自己去悟，而多邻国只会简单的在 Guide 中提一下要出现的句子，此后便是不断的重复。
这很像 SRS（间隔重复）的学习方式，但是它却希望用户通过重复建立起语感。我个人觉得建立语感最重要的是环境，即大量的不同的句子重复出现。
显然多邻国给出的句子太少了，每种表达只有寥寥几句。到最后用户可能什么也没学到。</p>
<p>总而言之，如果要学习一种语言，多邻国并不是一个很好的选择。但要是作为一个能够复习的游戏来说，倒也勉强合格。它只能拿来复习，至于拿来学习——还是找本书更靠谱些。</p>
<p class="font-size: 0.8em;">**10月21日追加**: 有关 Duolingo 的算法可见墨墨背单词于 21 年的研究报告：[maimemo/maimemo-memory-research](https://github.com/maimemo/maimemo-memory-research)</p>
<p>至于我抛开多邻国后去了哪？我将我的学习任务拆分成了单词和句子两部分。
单词现在依靠 Anki 搭配卡组 <a href="https://github.com/5mdld/anki-jlpt-decks">5mdld/anki-jlpt-decks</a>，
而句子则通过《皆の日本語》这本知名教材来完成。</p>
<p>目前 Anki 的效果如下</p>













<table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center"><img alt="Low Stability" width="1087" height="678" loading="lazy" decoding="async" src="/_astro/card_stability.DYWjoynE_Z1njd61.webp" ></td><td align="center"><img alt="High Difficulty" width="1024" height="631" loading="lazy" decoding="async" src="/_astro/card_difficulty.BtfLkcq__2746FI.webp" ></td></tr></tbody></table>
<p>看上去并不是很乐观的样子，不过就算是这样虽然负担很大，能背过的单词也比多邻国多多了。
至于最终的成效，等我通过了 N2 后会回来报告的。</p>
<h2 id="ボクの理想の-python">ボクの理想の Python</h2>
<p>回到大标题。</p>
<p>其实当我写下标题的时候，其实首先联想到的就是《ボクの理想の異世界生活》中的某个知名场面</p>
<p><img alt="SQL Magic" width="496" height="268" loading="lazy" decoding="async" src="/_astro/isekai.DB6k9yBs_Z1InYCC.webp" ></p>
<p>我为什么要起这个标题呢？因为我现在突然想做一个语言，用来表达我对 Python 的不满。</p>
<p>Python 是个好语言，它简单易学，拥有丰富的生态，能轻松的完成大部分的自动化或者胶水工作。
但是我觉得相比其他语言仍存在一些不足。这些不足并不是指带语义的缩进，也不是指性能，可能只是一些微不足道，但是我又十分有用的功能。</p>
<p>当前，下面的内容到现在只是理想中的样子，具体是什么样子还要等实现。
受限于个人对类型系统掌握的能力不足，很多内容更像是一种幻想，一种 TODO List。也许我会在 Python 淘汰之前实现的吧</p>
<p><del>现在已经新建工程 Sidewinder了，等写差不多放出来</del></p>
<h3 id="如何实现">如何实现</h3>
<p>Python 现在这个样子已经不是说改就改了，不如像 Kotlin 依赖 JVM 一样，依赖 Python VM 来创建一个新语言。</p>
<p>我们可以编译到 Python Bytecode 或者是 Pyhton。我们都可以做到很多的事情，同时不丢失 Python 的生态。</p>
<p>至于性能——我不会。<del>都写 Python 了就别在意那点性能了</del></p>
<h3 id="单脚本环境">单脚本环境</h3>
<p>现在 Python 的环境隔离依赖的是 Conda、Poetry 或 Venv 等方案，这些方案主要是针对项目提供的解决方法。
而对于单个文件的脚本来说，可能只是一个简单的任务，将依赖安装到全局会污染环境，而新建一个环境的话又会多出比脚本数量还多的文件。</p>
<p>Ammonite 的 Scala Script 提供了这样的方案：</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.zka5w.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="scala"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">$ivy</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">`com.lihaoyi::scalatags:0.7.0 compat`</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">scalatags</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Text</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">all</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">_</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">val</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">rendered</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> div(</span><span style="--0:#9ECBFF;--1:#032F62">"Moo"</span><span style="--0:#E1E4E8;--1:#24292E">).render</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import $ivy.&#x60;com.lihaoyi::scalatags:0.7.0 compat&#x60;, scalatags.Text.all._val rendered = div(&#x22;Moo&#x22;).render"><div></div></button></div></figure></div>
<p>这里的 <code>import $ivy</code> 提供了一种从远程主机导入依赖的方式，那么我们是否也能模仿这种行为？例如加入语法</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FDAEB7;--0fs:italic;--1:#B31D28;--1fs:italic">$</span><span style="--0:#E1E4E8;--1:#24292E">pip.pandas.</span><span style="--0:#9ECBFF;--1:#032F62">"latest"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import $pip.pandas.&#x22;latest&#x22;"><div></div></button></div></figure></div>
<p>可以将依赖放在 <code>$HOME/.pycache/&#x3C;name>/&#x3C;version></code>， 在启动前将对象的目录放在环境变量中。这并不是一个很难解决的问题。</p>
<h3 id="traittypeclass">Trait/Typeclass</h3>
<p>是的，越来越多的语言开始加入这一套机制了。这可能也是对我最大的挑战。
比其继承，通过 trait/typeclass 可以更好的表示数据所能支持的操作。</p>
<p>比如在 Haskell 中通过 typeclass，可以轻而易举的支持很多操作</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="haskell"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">newtype</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">{ runParser </span><span style="--0:#F97583;--1:#BF3441">::</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">String</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Maybe</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">String</span><span style="--0:#E1E4E8;--1:#24292E">, a)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">instance</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Functor</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">where</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">fmap f p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">$</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">\</span><span style="--0:#E1E4E8;--1:#24292E">input </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">(input', a) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;-</span><span style="--0:#E1E4E8;--1:#24292E"> runParser p input</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">Just</span><span style="--0:#E1E4E8;--1:#24292E"> (input', f a)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">instance</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Applicative</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">where</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">pure x </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">$</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">\</span><span style="--0:#E1E4E8;--1:#24292E">input </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Just</span><span style="--0:#E1E4E8;--1:#24292E"> (input, x)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> f1) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;*></span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> f2) </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">$</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">\</span><span style="--0:#E1E4E8;--1:#24292E">input </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">(input', f) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;-</span><span style="--0:#E1E4E8;--1:#24292E"> f1 input</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">(input'', a) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;-</span><span style="--0:#E1E4E8;--1:#24292E"> f2 input'</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">Just</span><span style="--0:#E1E4E8;--1:#24292E"> (input'', f a)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">instance</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Alternative</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">where</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">empty </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">$</span><span style="--0:#E1E4E8;--1:#24292E"> const </span><span style="--0:#79B8FF;--1:#005CC5">Nothing</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> f1) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;|></span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> f2) </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">$</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">\</span><span style="--0:#E1E4E8;--1:#24292E">input </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> f1 input </span><span style="--0:#F97583;--1:#BF3441">&#x3C;|></span><span style="--0:#E1E4E8;--1:#24292E"> f2 input</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="newtype Parser a = Parser  { runParser :: String -> Maybe (String, a)  }instance Functor Parser where  fmap f p = Parser $ \input -> do    (input&#x27;, a) <- runParser p input    Just (input&#x27;, f a)instance Applicative Parser where  pure x = Parser $ \input -> Just (input, x)  (Parser f1) <*> (Parser f2) = Parser $ \input -> do    (input&#x27;, f) <- f1 input    (input&#x27;&#x27;, a) <- f2 input&#x27;    Just (input&#x27;&#x27;, f a)instance Alternative Parser where  empty = Parser $ const Nothing  (Parser f1) <|> (Parser f2) = Parser $ \input -> f1 input <|> f2 input"><div></div></button></div></figure></div>
<p>通过为 Parser 类型实现了函子（Functor）、应用函子（Applicative）和替换函子（Alternative），我们可以组合Parser类型，
进而得到很多其他例如 <code>some</code>, <code>any</code>, <code>traverse</code>, <code>&#x3C;*</code> 等操作。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="haskell"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">charP</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">::</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Char</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Char</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">charP c </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> f</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">where</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f </span><span style="--0:#79B8FF;--1:#005CC5">[]</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Nothing</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f (y </span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> ys)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> y </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> c </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Just</span><span style="--0:#E1E4E8;--1:#24292E"> (ys, c)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> otherwise </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Nothing</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">stringP</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">::</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">String</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">Parser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">String</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">stringP </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> traverse charP</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="charP :: Char -> Parser CharcharP c = Parser f  where    f [] = Nothing    f (y : ys)      | y == c = Just (ys, c)      | otherwise = NothingstringP :: String -> Parser StringstringP = traverse charP"><div></div></button></div></figure></div>
<p>我觉得这是传统的继承方式无法比拟的。</p>
<p>Note: Rust 的 nom 库也实现了类似的操作。</p>
<h3 id="tagged-union">Tagged Union</h3>
<p>好像也是个很大的挑战。具体可以见 <a href="https://en.wikipedia.org/wiki/Tagged_union">Wiki: Tagged union</a>。</p>
<p>2024 年，就连 Java 17 都已经支持了这种类型（称为 Sealing）。通过这种方式可以避免很多错误，我觉得大家应该都
品尝过 Rust 中的 <code>Option</code> 类型了，它就是一种 Tagged Union。</p>
<p>Python 作为动态类型语言，支持它是个很大的挑战。因为静态分析时类型信息很容易丢失——只需要不写 type hinting。</p>
<p>然而如果新建一个静态类型的语言，那这个问题自然存在解决方案。<del>不过还是挺难的</del></p>
<h3 id="更好的-map-reduce">更好的 Map, Reduce</h3>
<p>现在 Python 中的 map-reduce 长这样</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> functools </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">reduce</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FFAB70;--1:#AE4B07">reduce</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">lambda</span><span style="--0:#E1E4E8;--1:#24292E"> a,b: a</span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E">b, </span><span style="--0:#79B8FF;--1:#005CC5">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">int</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">input</span><span style="--0:#E1E4E8;--1:#24292E">().split()))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from functools import reducereduce(lambda a,b: a+b, map(int, input().split()))"><div></div></button></div></figure></div>
<p>这里的 reduce 竟然需要导包才能实现，听说 Guido van Rossum 称 map, reduce 并不很 Pythonic，
因此拒绝将这些功能添加进 Python。
并且更推荐使用 <code>[int (x) for x in input().split()]</code> 这种方式。此外，匿名函数是依赖 lambda 表达式实现的，并不支持多行。我觉得这对表达能力是很强的限制。</p>
<p>这里可能并不设计谁对谁错，只是个人理念不同。但是我还是更喜欢 Kotlin/Rust 这种链式调用</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kt"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">readlint</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">split</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">{ it.</span><span style="--0:#B392F0;--1:#6F42C1">toInt</span><span style="--0:#E1E4E8;--1:#24292E">() }</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">reduce</span><span style="--0:#E1E4E8;--1:#24292E"> { a, b </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> b}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="readlint().split(&#x22; &#x22;)  .map{ it.toInt() }  .reduce { a, b -> a + b}"><div></div></button></div></figure></div>
<p>亦或是 Elixir 的管道</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="elixir"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">IO</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">gets</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">|></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">String</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">split</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">|></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Enum</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(&#x26;</span><span style="--0:#B392F0;--1:#6F42C1">String</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">to_integer</span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">|></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Enum</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">reduce</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#F97583;--1:#BF3441">fn</span><span style="--0:#E1E4E8;--1:#24292E"> x, acc </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> x </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> acc </span><span style="--0:#F97583;--1:#BF3441">end</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="IO.gets(&#x22;&#x22;)  |> String.split()  |> Enum.map(&#x26;String.to_integer/1)  |> Enum.reduce(0, fn x, acc -> x + acc end)"><div></div></button></div></figure></div>
<p>无论如何，我觉得后两者都比 Python 的括号嵌套清楚多了。</p>
<p>我觉得这可以和前面的提到的 typeclass 结合，提供一个操作（类型 <code>Functor</code> 中的 <code>fmap</code>），即可支持相当多的操作。</p>
<h3 id="惰性求值">惰性求值</h3>
<p>可能是个很难，也没这么有用，也会对性能造成负担的地方。</p>
<p>它最主要的功能是能够支持无限长的列表，从而实现一些特殊的函数。比如 Haskell 官网的上展示的素数函数</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="haskell"><code><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">primes </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> filterPrime [</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#F97583;--1:#BF3441">..</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">where</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">filterPrime (p</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E">xs) </span><span style="--0:#F97583;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> filterPrime [x </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> x </span><span style="--0:#F97583;--1:#BF3441">&#x3C;-</span><span style="--0:#E1E4E8;--1:#24292E"> xs, x </span><span style="--0:#F97583;--1:#BF3441">`mod`</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">/=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="primes = filterPrime [2..] where  filterPrime (p:xs) =    p : filterPrime [x | x <- xs, x &#x60;mod&#x60; p /= 0]"><div></div></button></div></figure></div>
<p>不觉得这很 Cyberpunk 吗？</p>
<p>这大概可以利用 Python 中的异步机制实现，但要对原代码做很多变换。
实在写不出来的话就要参照虎书考虑携带一个大 Chunk 了。</p>
<hr>
<p>我的幻想目前就是这样子。至于工期，我觉得要按年为单位了。毕竟现在开始逐渐没太有时间写 hobby project 了。</p>
<p><del>不过怎么越看越有 Lisp 方言 Hy 的样子了</del></p>
<p>Thanks to:</p>
<ul>
<li><a href="https://lemonhx.moe/pldmd">编程语言设计踩坑实录</a></li>
</ul>  </article> <footer class="mt-5">  <div class="flex items-center gap-2"> <a title="上一篇: CPS 变换" href="/posts/fun/cps-trans"> <span class="inline-block vertical-mid i-mdi-chevron-double-left w-4 h-4"></span> 上一篇: CPS 变换 </a> <a title="下一篇: CPS 与 Rust Result" href="/posts/fun/cps-rust"> 下一篇: CPS 与 Rust Result <span class="inline-block vertical-mid i-mdi-chevron-double-right w-4 h-4"></span> </a> </div> </footer>  <div py-16><giscus-widget id="comments" repo="mslxl/mslxl.github.io" repoId="MDEwOlJlcG9zaXRvcnkxMjcwMTEwMjI=" category="Show and tell" categoryId="DIC_kwDOB5IIzs4CfW4f" mapping="title" strict="0" reactionsEnabled="1" emitMetadata="1" inputPosition="top" theme="light" lang="zh-CN" loading="lazy"></giscus-widget> <script type="module" src="/_astro/Giscus.astro_astro_type_script_index_0_lang.D05zVpD0.js"></script></div>  <div class="p-10" data-astro-cid-e5lvscu2> <div data-astro-cid-e5lvscu2> <img class="m-auto" src="https://moe-counter.glitch.me/get/@mslxl" alt="moe-counter" data-astro-cid-e5lvscu2> <p class="text-sm text-gray-500 text-center" data-astro-cid-e5lvscu2>统计自 2024 年 9 月</p> </div> </div> </main> <footer class="transition-swup-footer py-7.5" lg="row-2-3 col-2-3" data-astro-cid-e5lvscu2> <p data-astro-cid-gcn2mc3v>
© 2025 <a target="_blank" href="https://blog.mslxl.com" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Mslxl</a> </p> <p data-astro-cid-gcn2mc3v>
Theme
<a target="_blank" href="https://github.com/Moeyua/astro-theme-typography" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Typography</a>
by <a target="_blank" href="https://moeyua.com" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Moeyua</a> </p> <p data-astro-cid-gcn2mc3v>
Proudly published with
<a target="_blank" href="https://astro.build" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Astro</a> </p>  </footer> </div> <script type="module">document.addEventListener("animationend",e,!1);function e(){document.documentElement.classList.remove("animation-prepared"),document.removeEventListener("animationend",e,!1)}</script>   </body></html> <script type="module">function u(e){const t=document.createElement("pre");return t.style.width="1px",t.style.height="1px",t.style.position="fixed",t.style.top="5px",t.textContent=e,t}function a(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e.textContent||"");const t=getSelection();if(t==null)return Promise.reject(new Error);t.removeAllRanges();const n=document.createRange();return n.selectNodeContents(e),t.addRange(n),document.execCommand("copy"),t.removeAllRanges(),Promise.resolve()}function i(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e);const t=document.body;if(!t)return Promise.reject(new Error);const n=u(e);return t.appendChild(n),a(n),t.removeChild(n),Promise.resolve()}async function d(e){const t=e.getAttribute("for"),n=e.getAttribute("value");function o(){e.dispatchEvent(new CustomEvent("clipboard-copy",{bubbles:!0}))}if(e.getAttribute("aria-disabled")!=="true"){if(n)await i(n),o();else if(t){const r="getRootNode"in Element.prototype?e.getRootNode():e.ownerDocument;if(!(r instanceof Document||"ShadowRoot"in window&&r instanceof ShadowRoot))return;const c=r.getElementById(t);c&&(await p(c),o())}}}function p(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?i(e.value):e instanceof HTMLAnchorElement&&e.hasAttribute("href")?i(e.href):a(e)}function f(e){const t=e.currentTarget;t instanceof HTMLElement&&d(t)}function l(e){if(e.key===" "||e.key==="Enter"){const t=e.currentTarget;t instanceof HTMLElement&&(e.preventDefault(),d(t))}}function m(e){e.currentTarget.addEventListener("keydown",l)}function y(e){e.currentTarget.removeEventListener("keydown",l)}class h extends HTMLElement{static define(t="clipboard-copy",n=customElements){return n.define(t,this),this}constructor(){super(),this.addEventListener("click",f),this.addEventListener("focus",m),this.addEventListener("blur",y)}connectedCallback(){this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.hasAttribute("role")||this.setAttribute("role","button")}get value(){return this.getAttribute("value")||""}set value(t){this.setAttribute("value",t)}}const s=typeof globalThis<"u"?globalThis:window;try{s.ClipboardCopyElement=h.define()}catch(e){if(!(s.DOMException&&e instanceof DOMException&&e.name==="NotSupportedError")&&!(e instanceof ReferenceError))throw e}document.addEventListener("clipboard-copy",e=>{const n=e.target.querySelector(".icon");n.classList.replace("i-mdi-content-copy","i-mdi-check"),setTimeout(()=>{n.classList.replace("i-mdi-check","i-mdi-content-copy")},1500)});const b=Array.from(document.querySelectorAll("pre")),g="<div class='i-mdi-content-copy icon text-white'></div>";for(const e of b){const t=document.createElement("div");t.className="code-container";const n=document.createElement("clipboard-copy"),o=e.querySelector("code");n.value=o?.textContent??"",n.className="clipboard-copy",n.innerHTML=g,e.appendChild(n),e.parentNode?.insertBefore(t,e),t.appendChild(e)}</script> 