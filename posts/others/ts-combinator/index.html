<!DOCTYPE html><html lang="zh-cn" class="animation-prepared"> <head><title>使用 ts 实现 Parser 组合子</title><meta charset="utf-8"><link rel="canonical" href="https://blog.mslxl.com/posts/others/ts-combinator/"><meta name="description" content="My story of discovery"><meta name="robots" content="index, follow"><meta property="og:title" content="使用 ts 实现 Parser 组合子"><meta property="og:type" content="article"><meta property="og:image" content="https://blog.mslxl.com/placeholder.png"><meta property="og:url" content="https://blog.mslxl.com"><link rel="icon" href="/favicon.jpg" type="image/jpg"><link rel="alternate" type="application/rss+xml" title="Integrate Life" href="https://blog.mslxl.com/atom.xml"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.1.9"><meta name="twitter:image:src" content="https://blog.mslxl.com/placeholder.png"><meta name="twitter:image:alt" content="My story of discovery"><meta name="twitter:creator" content="@mslxl_bak"><meta name="twitter:site" content="@mslxl_bak"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="使用 ts 实现 Parser 组合子"><meta name="twitter:description" content="My story of discovery"><link rel="stylesheet" href="/_astro/_page_.CZH6Yv9J.css">
<style>.tk-meta-input{background-color:#fff}
p[data-astro-cid-gcn2mc3v]{font-size:.75rem;font-weight:700}html.animation-prepared .transition-swup-header[data-astro-cid-e5lvscu2],html.animation-prepared .transition-swup-footer[data-astro-cid-e5lvscu2]{animation:fade-in-down 1s linear 1}@media (min-width: 1024px){html.animation-prepared .transition-swup-header[data-astro-cid-e5lvscu2],html.animation-prepared .transition-swup-footer[data-astro-cid-e5lvscu2]{animation-name:fade-in-left}}html.animation-prepared .transition-swup-main[data-astro-cid-e5lvscu2]{animation:fade-in-down 1s linear 1}@keyframes fade-in-down{0%{transform:translateY(-1rem);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes fade-in-left{0%{opacity:0;transform:translate(1rem)}to{opacity:1;transform:translate(0)}}html.is-animating .transition-swup-main[data-astro-cid-e5lvscu2]{opacity:0;transform:translateY(-1rem)}html.is-leaving .transition-swup-main[data-astro-cid-e5lvscu2]{opacity:0;transform:translateY(1rem)}.transition-swup-main[data-astro-cid-e5lvscu2]{transition-duration:.5s;transition-timing-function:linear;transform:translateY(0);opacity:1}
.code-container{position:relative}.clipboard-copy{position:absolute;top:.5rem;right:.5rem;width:1.75rem;height:1.75rem;display:flex;justify-content:center;align-items:center;border-radius:.25rem}.clipboard-copy:hover{background-color:#30363d}
</style>
<link rel="stylesheet" href="/_astro/index.DuX3xYS3.css"><script type="module" src="/_astro/page.9zgADcL1.js"></script></head> <body>   <div class="h-100vh max-w-6xl min-w-390px mx-a grid-gap-x-28" p="7.5 lg:y-0 lg:x-20" lg="grid cols-[3fr_1fr] rows-[1fr_9rem]" data-astro-cid-e5lvscu2> <header class="transition-swup-header flex flex-col gap-2.5" m="7.5 lg:x-0 lg:t-20 lg:b-4" lg="row-1-2 col-2-3 justify-between items-start" data-astro-cid-e5lvscu2> <hgroup lg="write-vertical-right items-start b-l-2px b-l-primary-solid text-left" flex="~ col gap-2.5" class="cursor-pointer text-center duration-800 ease-in-out"> <a class="not-underline-hover duration-800 ease-in-out" lg:p="x-2.5 b-12 hover:t-3.75 hover:b-8.75" hover:lg=" bg-primary color-background" href="/"> <h3 class="text-5 font-extrabold font-header">Mslxl&#39;s Blog</h3> <h1 class="text-8 font-extrabold font-header">Integrate Life</h1> </a> </hgroup> <nav class="text-center font-bold" flex="~ col gap-4"> <ul lg="flex-col items-start text-4" class="text-3.5" flex="~ row gap-2 justify-center"> <li> <a class="" href="/"> 文章 </a> </li><li> <a class="" href="/archive"> 归档 </a> </li><li> <a class="" href="/categories"> 分类 </a> </li><li> <a class="" href="/tomodachi"> 友人 </a> </li><li> <a class="" href="/about"> 关于 </a> </li> </ul> <ul flex="~ row gap-1 justify-center"> <li> <a href="https://github.com/mslxl/" target="_blank" title="github" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-github w-6 h-6">github</span> </a> </li><li> <a href="/atom.xml" target="_blank" title="rss" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-rss w-6 h-6">rss</span> </a> </li><li> <a href="https://mastodon.social/@mslxl" target="_blank" title="mastodon" class="not-underline-hover inline-flex items-center"> <span class="i-mdi-mastodon w-6 h-6">mastodon</span> </a> </li> </ul> </nav> </header> <main class="transition-swup-main link-fill overflow-y-scroll scrollbar-hide outline-none" lg="row-1-3 col-1-2 py-20 " data-astro-cid-e5lvscu2>   <article class="prose"> <header flex="~ col"> <h1 class="post-title"> <a class="not-prose" href="/posts/others/ts-combinator/">使用 ts 实现 Parser 组合子</a> </h1> <div class="text-3.5"> <span>发布于</span> <time>2022-10-07</time> <a href="/categories/TypeScript">
# TypeScript </a> </div> </header>  <p>Parser 组合子(Parser Combinator) 可用于实现词法分析器或者 LL 语法分析器，它的实现较为简单，但缺点是运行效率较低(尤其是在组合层数较多时)，在对性能要求不高时可采用 Parser 组合子来进行解析任务。</p>
<p>本文最终会实现这样的 Parser Combinator:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.4dwm6.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">input</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'114514aabbcc'</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">result</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> parser.</span><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()(input)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">console.</span><span style="--0:#B392F0;--1:#6F42C1">log</span><span style="--0:#E1E4E8;--1:#24292E">(result)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: 'aabbcc', second: '114514' } }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const input = &#x27;114514aabbcc&#x27;const result = parser.digit1()(input)console.log(result)// { kind: &#x27;Right&#x27;, right: { first: &#x27;aabbcc&#x27;, second: &#x27;114514&#x27; } }"><div></div></button></div></figure></div>
<hr>
<h2 id="准备-either">准备: <code>Either</code></h2>
<p>要表示 Parser Combinator，首先要先分别表示出 parse 成功和失败的两种状态。
本文采用了类似 <code>Either</code> 的概念，其 Left 储存错误信息，而 Right 储存匹配成功项和剩余项。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">interface</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Left</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">readonly</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">kind</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Left'</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FFAB70;--1:#AE4B07">left</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">E</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">interface</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Right</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">readonly</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">kind</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Right'</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FFAB70;--1:#AE4B07">right</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">E</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">type</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Left</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Right</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export interface Left<E> {  readonly kind: &#x27;Left&#x27;  left: E}export interface Right<E> {  readonly kind: &#x27;Right&#x27;  right: E}export type Either<L, R> = Left<L> | Right<R>"><div></div></button></div></figure></div>
<p>为了方便对 <code>Either</code> 的基本操作，我们添加以下代码:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">interface</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">F</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">S</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FFAB70;--1:#AE4B07">first</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">F</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FFAB70;--1:#AE4B07">second</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">S</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">left</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">value</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">kind: </span><span style="--0:#9ECBFF;--1:#032F62">'Left'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">left: value</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">right</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">value</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">kind: </span><span style="--0:#9ECBFF;--1:#032F62">'Right'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">right: value</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">is_left</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">either</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">boolean</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.kind </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Left'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">is_right</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">never</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">either</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">boolean</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.kind </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Right'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export interface Pair<F, S> {  first: F  second: S}export function left<L, R = never>(value: L): Either<L, R> {  return {    kind: &#x27;Left&#x27;,    left: value  }}export function right<R, L = never>(value: R): Either<L, R> {  return {    kind: &#x27;Right&#x27;,    right: value  }}export function is_left<L = never, R = never>(either: Either<L, R>): boolean {  return either.kind == &#x27;Left&#x27;}export function is_right<L = never, R = never>(either: Either<L, R>): boolean {  return either.kind == &#x27;Right&#x27;}"><div></div></button></div></figure></div>
<p>其中 <code>left</code> 和 <code>right</code> 用于构造一个 <code>Either</code></p>
<h2 id="第一个-parser-组合子-text">第一个 Parser 组合子: <code>text</code></h2>
<p>有了这些准备，我们就可以实现一个最简单的 Parser 组合子了。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">type</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">>></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">text</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#FFAB70;--1:#AE4B07">expect</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">>> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (input.</span><span style="--0:#B392F0;--1:#6F42C1">startsWith</span><span style="--0:#E1E4E8;--1:#24292E">(expect)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">right</span><span style="--0:#E1E4E8;--1:#24292E">({ first: input.</span><span style="--0:#B392F0;--1:#6F42C1">substring</span><span style="--0:#E1E4E8;--1:#24292E">(expect.</span><span style="--0:#79B8FF;--1:#005CC5">length</span><span style="--0:#E1E4E8;--1:#24292E">), second: expect })</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">left</span><span style="--0:#E1E4E8;--1:#24292E">(expect)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="type Parser<E, L> = (input: string) => either.Either<L, Pair<string, E>>export function text(expect: string): Parser<string, string> {  return function (input: string): either.Either<string, Pair<string, string>> {    if (input.startsWith(expect)) {      return either.right({ first: input.substring(expect.length), second: expect })    }    else {      return either.left(expect)    }  }}"><div></div></button></div></figure></div>
<p>如果 <code>input</code> 是以 <code>expect</code> 开头的字符串，则返回 <code>Right</code> 表示匹配成功，否则返回 <code>Left</code> 表示失败。这样我们就可以使用 text 来匹配特定的字符了</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">input</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'114514abababa'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">result</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">text</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">'114'</span><span style="--0:#E1E4E8;--1:#24292E">)(input)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">console.</span><span style="--0:#B392F0;--1:#6F42C1">log</span><span style="--0:#E1E4E8;--1:#24292E">(result)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: '514abababa', second: '114' } }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const input = &#x27;114514abababa&#x27;const result = text(&#x27;114&#x27;)(input)console.log(result)// { kind: &#x27;Right&#x27;, right: { first: &#x27;514abababa&#x27;, second: &#x27;114&#x27; } }"><div></div></button></div></figure></div>
<p>很明显这远远不够，因为有时我们不能确定要匹配的文本出现顺序，比方说我们要匹配一个数字，但是不能确定数字是什么，使用 <code>text</code> 就无能为力了，这时候我们就需要一个新的组合子来修饰旧组合子了。</p>
<h2 id="oneof-parser-组合子"><code>oneOf</code> Parser 组合子</h2>
<p>我们在下面实现一个 <code>oneOf</code> 组合子，它将从提供的所有 Parser 组合子中选择第一个匹配成功项并返回。</p>
<p>从一系列结果中选择成功项很容易让我们联想到 <code>Alternative</code> 的性质，所以让我们先让结果 <code>Either</code> 能进行 <code>Alternative</code> 的运算吧(即实现 <code>alt</code> 和 <code>map</code> 函数)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">either</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>, </span><span style="--0:#B392F0;--1:#6F42C1">block</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">right</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (either.kind </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Right'</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">value</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">block</span><span style="--0:#E1E4E8;--1:#24292E">(either.right)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">right</span><span style="--0:#E1E4E8;--1:#24292E">(value)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">alt</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#F97583;--1:#BF3441">...</span><span style="--0:#FFAB70;--1:#AE4B07">either</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>[])</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">reduce</span><span style="--0:#E1E4E8;--1:#24292E">((</span><span style="--0:#FFAB70;--1:#AE4B07">p</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">c</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (p.kind </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'Right'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> p</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> c</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function map<L, R, E>(either: Either<L, R>, block: (right: R) => E): Either<L, E> {  if (either.kind == &#x27;Right&#x27;) {    const value = block(either.right)    return right(value)  }  else {    return either as Either<L, E>  }}export function alt<L, R>(...either: Either<L, R>[]): Either<L, R> {  return either.reduce((p, c) => {    if (p.kind == &#x27;Right&#x27;)      return p    else return c  })}"><div></div></button></div></figure></div>
<p><code>map</code> 会对 <code>Right</code> 中的元素进行操作，原样返回 <code>Left</code> 中的元素，<code>alt</code> 则会选择第一个 <code>Right</code>，抛弃前面的所有 <code>Left</code>（放在 Haskell 上也就是使 <code>Either</code> 是 <code>Alternative</code> 的一个实现）</p>
<p>有了 <code>alt</code>， 我们很容易实现 <code>oneOf</code> 函数。只需要从所有匹配结果中选择第一个成功项即可（即 <code>Right</code>)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">oneOf</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#F97583;--1:#BF3441">...</span><span style="--0:#FFAB70;--1:#AE4B07">parsers</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>[])</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">>> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">>> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> parsers</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#FFAB70;--1:#AE4B07">p</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">p</span><span style="--0:#E1E4E8;--1:#24292E">(input))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">reduce</span><span style="--0:#E1E4E8;--1:#24292E">((</span><span style="--0:#FFAB70;--1:#AE4B07">c</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">p</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">alt</span><span style="--0:#E1E4E8;--1:#24292E">(c, p))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function oneOf<E, L>(...parsers: Parser<E, L>[]): (input: string) => either.Either<L, Pair<string, E>> {  return function (input: string): either.Either<L, Pair<string, E>> {    return parsers      .map(p => p(input))      .reduce((c, p) => either.alt(c, p))  }}"><div></div></button></div></figure></div>
<p>让我们来试着匹配任一个数字:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> [</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">3</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">4</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">9</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digitParser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> digit.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#FFAB70;--1:#AE4B07">i</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">text</span><span style="--0:#E1E4E8;--1:#24292E">(i.</span><span style="--0:#B392F0;--1:#6F42C1">toString</span><span style="--0:#E1E4E8;--1:#24292E">()))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">oneOf</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">...</span><span style="--0:#E1E4E8;--1:#24292E">digitParser)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()(</span><span style="--0:#9ECBFF;--1:#032F62">'1145aa'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: '145aa', second: '1' } }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function digit1(): Parser<string, string> {  const digit = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  const digitParser = digit.map(i => text(i.toString()))  return oneOf(...digitParser)}digit1()(&#x27;1145aa&#x27;)// { kind: &#x27;Right&#x27;, right: { first: &#x27;145aa&#x27;, second: &#x27;1&#x27; } }"><div></div></button></div></figure></div>
<p>那么如果我们想要匹配一串数字怎么办？这时候就要借助 <code>many</code> 了</p>
<h2 id="many-parser-组合子"><code>many</code> Parser 组合子</h2>
<p>让我们先理一下 <code>many</code> 的行为。<code>many</code> 会不停的使用提供的组合子进行匹配，直到匹配失败为止，以数组的形式返回之前的匹配成功项。</p>
<p>下面是代码，<del>写的有点摸鱼，但是能用</del></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">many0</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">parser</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">[], </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">[]>> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">result</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">[] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">let</span><span style="--0:#E1E4E8;--1:#24292E"> err</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">null</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">let</span><span style="--0:#E1E4E8;--1:#24292E"> success </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">false</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">v</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">parser</span><span style="--0:#E1E4E8;--1:#24292E">(input)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (either.</span><span style="--0:#B392F0;--1:#6F42C1">is_left</span><span style="--0:#E1E4E8;--1:#24292E">(v)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">err </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (v </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Left</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>).left</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">break</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">success </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">rv</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> v </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Right</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">>></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">input </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> rv.right.first</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">result.</span><span style="--0:#B392F0;--1:#6F42C1">push</span><span style="--0:#E1E4E8;--1:#24292E">(rv.right.second)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (success) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">right</span><span style="--0:#E1E4E8;--1:#24292E">({ first: input, second: result })</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">left</span><span style="--0:#E1E4E8;--1:#24292E">(err)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function many0<E, L>(parser: Parser<E, L>): Parser<E[], L> {  return function (input: string): either.Either<L, Pair<string, E[]>> {    const result: E[] = []    let err: L = null    let success = false    while (true) {      const v = parser(input)      if (either.is_left(v)) {        err = (v as either.Left<L>).left        break      }      else {        success = true        const rv = v as either.Right<Pair<string, E>>        input = rv.right.first        result.push(rv.right.second)      }    }    if (success) {      return either.right({ first: input, second: result })    }    else {      return either.left(err)    }  }}"><div></div></button></div></figure></div>
<p>让我们用 <code>many</code> 和 <code>oneOf</code> 试着匹配一串数字，修改 <code>digit1</code> 函数如下:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> [</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">3</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">4</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">9</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digitParser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> digit.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#FFAB70;--1:#AE4B07">i</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">text</span><span style="--0:#E1E4E8;--1:#24292E">(i.</span><span style="--0:#B392F0;--1:#6F42C1">toString</span><span style="--0:#E1E4E8;--1:#24292E">()))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">many0</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">oneOf</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">...</span><span style="--0:#E1E4E8;--1:#24292E">digitParser))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()(</span><span style="--0:#9ECBFF;--1:#032F62">'114aba'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: 'aba', second: ['1', '1', '4'] } }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function digit1(): Parser<string, string> {  const digit = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  const digitParser = digit.map(i => text(i.toString()))  return many0(oneOf(...digitParser))}digit1()(&#x27;114aba&#x27;)// { kind: &#x27;Right&#x27;, right: { first: &#x27;aba&#x27;, second: [&#x27;1&#x27;, &#x27;1&#x27;, &#x27;4&#x27;] } }"><div></div></button></div></figure></div>
<p>似乎成功了，但是返回结果是 <code>['1', '1', '4']</code>，我们想要的是 <code>114</code>，怎么办？</p>
<p>很遗憾没有办法，parser 组合子就是从最小的单位开始匹配，匹配结果理所当然的是一个一个的最小单元，但是你可以在 <code>many</code> 中将这些元素拼起来(不推荐)，或者再创建一个用于处理匹配结果的组合子。</p>
<p>这里利用 <code>Either</code> 的 <code>map</code> 再写一个 <code>map</code> 组合子用于处理匹配结果：</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#FFAB70;--1:#AE4B07">parser</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">>, </span><span style="--0:#B392F0;--1:#6F42C1">block</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">e</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">E</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">either</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">Either</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">L</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">Pair</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#B392F0;--1:#6F42C1">R</span><span style="--0:#E1E4E8;--1:#24292E">>> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> either.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">parser</span><span style="--0:#E1E4E8;--1:#24292E">(input), (</span><span style="--0:#FFAB70;--1:#AE4B07">r</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">result</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">block</span><span style="--0:#E1E4E8;--1:#24292E">(r.second)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> { first: r.first, second: result }</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">})</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function map<E, L, R>(parser: Parser<E, L>, block: (e: E) => R): Parser<R, L> {  return function (input: string): either.Either<L, Pair<string, R>> {    return either.map(parser(input), (r) => {      const result = block(r.second)      return { first: r.first, second: result }    })  }}"><div></div></button></div></figure></div>
<p>再改造一下 <code>digit1</code> 函数：</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#F97583;--1:#BF3441">export</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">function</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()</span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Parser</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">string</span><span style="--0:#E1E4E8;--1:#24292E">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> [</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">3</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">4</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">9</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">digitParser</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> digit.</span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#FFAB70;--1:#AE4B07">i</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">text</span><span style="--0:#E1E4E8;--1:#24292E">(i.</span><span style="--0:#B392F0;--1:#6F42C1">toString</span><span style="--0:#E1E4E8;--1:#24292E">()))</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">map</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">many0</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">oneOf</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">...</span><span style="--0:#E1E4E8;--1:#24292E">digitParser)), (</span><span style="--0:#FFAB70;--1:#AE4B07">e</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> e.</span><span style="--0:#B392F0;--1:#6F42C1">reduce</span><span style="--0:#E1E4E8;--1:#24292E">((</span><span style="--0:#FFAB70;--1:#AE4B07">p</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">c</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">=></span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> c)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">})</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export function digit1(): Parser<string, string> {  const digit = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  const digitParser = digit.map(i => text(i.toString()))  return map(many0(oneOf(...digitParser)), (e) => {    return e.reduce((p, c) => p + c)  })}"><div></div></button></div></figure></div>
<p>现在我们已经可以用 <code>digit1</code> 来愉快的匹配数字了</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()(</span><span style="--0:#9ECBFF;--1:#032F62">'114514ababab'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: 'ababab', second: '114514' } }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">digit1</span><span style="--0:#E1E4E8;--1:#24292E">()(</span><span style="--0:#9ECBFF;--1:#032F62">'66ccff'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#99A0A6;--1:#616972">// { kind: 'Right', right: { first: 'ccff', second: '66' } }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="digit1()(&#x27;114514ababab&#x27;)// { kind: &#x27;Right&#x27;, right: { first: &#x27;ababab&#x27;, second: &#x27;114514&#x27; } }digit1()(&#x27;66ccff&#x27;)// { kind: &#x27;Right&#x27;, right: { first: &#x27;ccff&#x27;, second: &#x27;66&#x27; } }"><div></div></button></div></figure></div>
<p>当然， Parser 组合子还不仅如此，你还可以写出 <code>optional</code> 等等组合子，或者写出自己想要的组合子。Parser 组合子也不止可以处理字符串，只需改动少量代码，上述代码便可处理任意序列</p>
<p>这里有一份 Json 解析器是用 Haskell 写的 Parser 组合子，可共参考 <a href="https://github.com/mslxl/MeoAssistantArknightsCLI/blob/main/app/JsonParser.hs">JsonParser.hs</a></p>  </article> <footer class="mt-5">  <div class="flex items-center gap-2"> <a title="上一篇: Dev-C++ OpenCV 环境搭建" href="/posts/others/opencv-env"> <span class="inline-block vertical-mid i-mdi-chevron-double-left w-4 h-4"></span> 上一篇: Dev-C++ OpenCV 环境搭建 </a> <a title="下一篇: 关于消失的页面" href="/posts/others/2022-dispearpage"> 下一篇: 关于消失的页面 <span class="inline-block vertical-mid i-mdi-chevron-double-right w-4 h-4"></span> </a> </div> </footer>  <div py-16><giscus-widget id="comments" repo="mslxl/mslxl.github.io" repoId="MDEwOlJlcG9zaXRvcnkxMjcwMTEwMjI=" category="Show and tell" categoryId="DIC_kwDOB5IIzs4CfW4f" mapping="title" strict="0" reactionsEnabled="1" emitMetadata="1" inputPosition="top" theme="light" lang="zh-CN" loading="lazy"></giscus-widget> <script type="module" src="/_astro/Giscus.astro_astro_type_script_index_0_lang.BHVzw2Eb.js"></script></div>  <div class="p-10" data-astro-cid-e5lvscu2> <div data-astro-cid-e5lvscu2> <img class="m-auto" src="https://moe-counter.glitch.me/get/@mslxl" alt="moe-counter" data-astro-cid-e5lvscu2> <p class="text-sm text-gray-500 text-center" data-astro-cid-e5lvscu2>统计自 2024 年 9 月</p> </div> </div> </main> <footer class="transition-swup-footer py-7.5" lg="row-2-3 col-2-3" data-astro-cid-e5lvscu2> <p data-astro-cid-gcn2mc3v>
© 2025 <a target="_blank" href="https://blog.mslxl.com" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Mslxl</a> </p> <p data-astro-cid-gcn2mc3v>
Theme
<a target="_blank" href="https://github.com/Moeyua/astro-theme-typography" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Typography</a>
by <a target="_blank" href="https://moeyua.com" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Moeyua</a> </p> <p data-astro-cid-gcn2mc3v>
Proudly published with
<a target="_blank" href="https://astro.build" rel="noopener noreferrer" data-astro-cid-gcn2mc3v>Astro</a> </p>  </footer> </div> <script type="module">document.addEventListener("animationend",e,!1);function e(){document.documentElement.classList.remove("animation-prepared"),document.removeEventListener("animationend",e,!1)}</script>   </body></html> <script type="module">function u(e){const t=document.createElement("pre");return t.style.width="1px",t.style.height="1px",t.style.position="fixed",t.style.top="5px",t.textContent=e,t}function a(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e.textContent||"");const t=getSelection();if(t==null)return Promise.reject(new Error);t.removeAllRanges();const n=document.createRange();return n.selectNodeContents(e),t.addRange(n),document.execCommand("copy"),t.removeAllRanges(),Promise.resolve()}function i(e){if("clipboard"in navigator)return navigator.clipboard.writeText(e);const t=document.body;if(!t)return Promise.reject(new Error);const n=u(e);return t.appendChild(n),a(n),t.removeChild(n),Promise.resolve()}async function d(e){const t=e.getAttribute("for"),n=e.getAttribute("value");function o(){e.dispatchEvent(new CustomEvent("clipboard-copy",{bubbles:!0}))}if(e.getAttribute("aria-disabled")!=="true"){if(n)await i(n),o();else if(t){const r="getRootNode"in Element.prototype?e.getRootNode():e.ownerDocument;if(!(r instanceof Document||"ShadowRoot"in window&&r instanceof ShadowRoot))return;const c=r.getElementById(t);c&&(await p(c),o())}}}function p(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?i(e.value):e instanceof HTMLAnchorElement&&e.hasAttribute("href")?i(e.href):a(e)}function f(e){const t=e.currentTarget;t instanceof HTMLElement&&d(t)}function l(e){if(e.key===" "||e.key==="Enter"){const t=e.currentTarget;t instanceof HTMLElement&&(e.preventDefault(),d(t))}}function m(e){e.currentTarget.addEventListener("keydown",l)}function y(e){e.currentTarget.removeEventListener("keydown",l)}class h extends HTMLElement{static define(t="clipboard-copy",n=customElements){return n.define(t,this),this}constructor(){super(),this.addEventListener("click",f),this.addEventListener("focus",m),this.addEventListener("blur",y)}connectedCallback(){this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.hasAttribute("role")||this.setAttribute("role","button")}get value(){return this.getAttribute("value")||""}set value(t){this.setAttribute("value",t)}}const s=typeof globalThis<"u"?globalThis:window;try{s.ClipboardCopyElement=h.define()}catch(e){if(!(s.DOMException&&e instanceof DOMException&&e.name==="NotSupportedError")&&!(e instanceof ReferenceError))throw e}document.addEventListener("clipboard-copy",e=>{const n=e.target.querySelector(".icon");n.classList.replace("i-mdi-content-copy","i-mdi-check"),setTimeout(()=>{n.classList.replace("i-mdi-check","i-mdi-content-copy")},1500)});const b=Array.from(document.querySelectorAll("pre")),g="<div class='i-mdi-content-copy icon text-white'></div>";for(const e of b){const t=document.createElement("div");t.className="code-container";const n=document.createElement("clipboard-copy"),o=e.querySelector("code");n.value=o?.textContent??"",n.className="clipboard-copy",n.innerHTML=g,e.appendChild(n),e.parentNode?.insertBefore(t,e),t.appendChild(e)}</script> 